บทที่ 3: การดำเนินงาน

บทนี้นำเสนอกระบวนการพัฒนาระบบ Farmme อย่างละเอียด ตั้งแต่การเตรียมข้อมูล การวิเคราะห์ข้อมูลเบื้องต้น การพัฒนาโมเดล Machine Learning ไปจนถึงการพัฒนาแอปพลิเคชัน โดยเน้นการอธิบายขั้นตอนการทำงานและเหตุผลในการเลือกใช้เทคนิคต่างๆ เพื่อให้ผู้อ่านสามารถเข้าใจกระบวนการพัฒนาและสามารถนำไปประยุกต์ใช้ได้


3.1 ภาพรวมระบบและสถาปัตยกรรม

ระบบ Farmme ได้รับการออกแบบเป็นระบบแบบครบวงจร (End-to-End System) ที่ประกอบด้วย 4 โมเดลหลักที่ทำงานร่วมกันอย่างเป็นระบบ โดยแต่ละโมเดลมีหน้าที่เฉพาะทางและสามารถส่งผ่านข้อมูลระหว่างกันได้ สถาปัตยกรรมของระบบประกอบด้วย 3 ชั้นหลัก ได้แก่ ชั้นข้อมูล (Data Layer) ซึ่งจัดการการเก็บและเข้าถึงข้อมูล ชั้นโมเดล (Model Layer) ซึ่งประกอบด้วยโมเดล Machine Learning ทั้ง 4 โมเดล และชั้นแอปพลิเคชัน (Application Layer) ซึ่งเป็นส่วนติดต่อผู้ใช้

สถาปัตยกรรมของระบบใช้แนวทาง Client-Server โดย Frontend พัฒนาด้วย React และ TypeScript ทำหน้าที่เป็น Client ที่แสดงผลและรับข้อมูลจากผู้ใช้ Backend พัฒนาด้วย FastAPI ทำหน้าที่เป็น Server ที่ประมวลผลและให้บริการ API สำหรับการเรียกใช้โมเดล ฐานข้อมูลใช้ PostgreSQL ผ่าน Supabase สำหรับเก็บข้อมูลผู้ใช้และประวัติการใช้งาน ส่วนโมเดล Machine Learning ถูกฝึกด้วย Python และบันทึกเป็นไฟล์ .pkl เพื่อนำมาใช้งานผ่าน API


3.2 การเก็บรวบรวมและเตรียมข้อมูล

3.2.1 แหล่งที่มาของข้อมูล

เนื่องจากข้อจำกัดในการเข้าถึงข้อมูลการเกษตรจริงจากหน่วยงานราชการและระยะเวลาในการพัฒนาโครงการ ทีมผู้พัฒนาจึงได้สร้างชุดข้อมูลสังเคราะห์ (Synthetic Dataset) ที่มีคุณสมบัติทางสถิติสอดคล้องกับข้อมูลการเกษตรจริง การใช้ข้อมูลสังเคราะห์เป็นแนวทางที่ยอมรับในงานวิจัย Machine Learning โดยเฉพาะในกรณีที่ข้อมูลจริงมีข้อจำกัดในการเข้าถึง มีปัญหาด้านความเป็นส่วนตัว หรือต้องการควบคุมคุณภาพและความสมบูรณ์ของข้อมูล

การสร้างข้อมูลสังเคราะห์อ้างอิงจากข้อมูลสถิติและรูปแบบจากแหล่งต่างๆ ได้แก่ สถิติการเกษตรจากกระทรวงเกษตรและสหกรณ์ ข้อมูลราคาสินค้าเกษตรจากกรมการค้าภายใน ข้อมูลสภาพอากาศจากกรมอุตุนิยมวิทยา และงานวิจัยที่เกี่ยวข้องกับการเกษตรในประเทศไทย ระบบสร้างข้อมูลโดยใช้การเร่งความเร็วด้วย GPU ผ่าน PyTorch CUDA เพื่อสร้างข้อมูลที่มีความสัมพันธ์เชิงพื้นที่ (Spatial Correlation) และความสัมพันธ์เชิงเวลา (Temporal Correlation) ที่สมจริง

3.2.2 ชุดข้อมูลที่ใช้ในการศึกษา

ชุดข้อมูลที่ใช้ในการพัฒนาระบบประกอบด้วย 5 ชุดหลัก ดังนี้

ข้อมูลการเพาะปลูก (Cultivation Data) จำนวน 6,226 บันทึก ครอบคลุมช่วงเวลาตั้งแต่ 1 พฤศจิกายน 2023 ถึง 26 มีนาคม 2025 ประกอบด้วยข้อมูล 77 จังหวัดและ 46 ชนิดพืช แต่ละบันทึกมีข้อมูล 18 คอลัมน์ ได้แก่ จังหวัด ชนิดพืช วันที่ปลูก วันที่เก็บเกี่ยว พื้นที่ปลูก ผลผลิตที่คาดหวัง ผลผลิตจริง ประสิทธิภาพผลผลิต อัตราความสำเร็จ ต้นทุนการลงทุน ทักษะของเกษตรกร การยอมรับเทคโนโลยี การปรับเวลาเก็บเกี่ยว ความเสียหายจากเหตุการณ์รุนแรง คุณภาพสภาพอากาศ และตัวคูณผลผลิต

ข้อมูลสภาพอากาศ (Weather Data) จำนวน 56,287 บันทึก ครอบคลุมช่วงเวลาตั้งแต่ 1 พฤศจิกายน 2023 ถึง 31 ตุลาคม 2025 สำหรับ 77 จังหวัด ประกอบด้วยข้อมูลรายวันของอุณหภูมิ (องศาเซลเซียส) ปริมาณน้ำฝน (มิลลิเมตร) ความชื้นสัมพัทธ์ (เปอร์เซ็นต์) และดัชนีภัยแล้ง ข้อมูลสภาพอากาศมีความสัมพันธ์เชิงพื้นที่และเวลาที่สมจริง โดยจังหวัดที่อยู่ใกล้กันมีสภาพอากาศที่คล้ายคลึงกัน และมีรูปแบบตามฤดูกาลที่ชัดเจน

ข้อมูลราคา (Price Data) จำนวน 2,289,492 บันทึก ครอบคลุมช่วงเวลาเดียวกับข้อมูลสภาพอากาศ ประกอบด้วยข้อมูลราคารายวันของพืชแต่ละชนิดในแต่ละจังหวัด แยกตามประเภทตลาด (พ่อค้าคนกลาง ซุปเปอร์มาร์เก็ต และตลาดเกษตรกร) ข้อมูลราคามีความผันผวนที่สมจริงตามประเภทพืช มีรูปแบบตามฤดูกาล และมีความสัมพันธ์เชิงพื้นที่

ข้อมูลเศรษฐกิจ (Economic Data) จำนวน 731 บันทึก ประกอบด้วยตัวชี้วัดเศรษฐกิจรายวัน 9 ตัว ได้แก่ ราคาน้ำมันเชื้อเพลิง ราคาปุ๋ย ปริมาณการส่งออก อัตราเงินเฟ้อ อัตราการเติบโตของ GDP อัตราการว่างงาน ดัชนีความต้องการผัก ดัชนีความต้องการเครื่องเทศ และอัตราแลกเปลี่ยนบาทต่อดอลลาร์ ตัวชี้วัดเหล่านี้มีความสัมพันธ์ข้ามกัน เช่น ราคาน้ำมันมีความสัมพันธ์กับราคาปุ๋ย

ข้อมูลลักษณะพืช (Crop Characteristics) จำนวน 50 ชนิด ประกอบด้วยข้อมูลคุณลักษณะของพืชแต่ละชนิด เช่น ระยะเวลาการเจริญเติบโต ความต้องการน้ำ ความต้องการอุณหภูมิ ประเภทดินที่เหมาะสม และราคาฐาน



3.2.3 การตรวจสอบคุณภาพข้อมูล

ก่อนนำข้อมูลไปใช้ในการพัฒนาโมเดล มีการตรวจสอบคุณภาพข้อมูลอย่างละเอียดเพื่อให้แน่ใจว่าข้อมูลมีความสมบูรณ์และมีคุณสมบัติทางสถิติที่เหมาะสม การตรวจสอบประกอบด้วยหลายด้าน ได้แก่ การตรวจสอบค่าที่ขาดหาย (Missing Values) พบว่าข้อมูลทุกชุดไม่มีค่าที่ขาดหาย การตรวจสอบช่วงค่า (Value Range) พบว่าค่าทุกตัวอยู่ในช่วงที่สมเหตุสมผล เช่น อุณหภูมิอยู่ระหว่าง 15-40 องศาเซลเซียส ปริมาณน้ำฝนไม่เป็นลบ ราคาเป็นบวกทั้งหมด การตรวจสอบความสม่ำเสมอทางเวลา (Temporal Consistency) พบว่าวันที่เรียงลำดับอย่างถูกต้องและไม่มีช่องว่าง

การตรวจสอบคุณสมบัติทางสถิติพบว่าข้อมูลมีลักษณะที่สอดคล้องกับข้อมูลจริง ข้อมูลราคามีความผันผวน (Volatility) อยู่ในช่วงร้อยละ 10-30 ขึ้นอยู่กับประเภทพืช โดยพืชผักมีความผันผวนสูงกว่าพืชไร่ ความสัมพันธ์อัตโนมัติ (Autocorrelation) ของราคาอยู่ในช่วง 0.70-0.95 แสดงว่ามีความต่อเนื่องทางเวลา ข้อมูลสภาพอากาศมีความสัมพันธ์เชิงพื้นที่ที่สลายตัวตามระยะทาง โดยจังหวัดที่อยู่ใกล้กันมีความสัมพันธ์สูงกว่าจังหวัดที่อยู่ไกลกัน


3.3 การวิเคราะห์ข้อมูลเบื้องต้น (Exploratory Data Analysis)

3.3.1 การวิเคราะห์การกระจายของข้อมูล

การวิเคราะห์การกระจายของข้อมูลราคาพบว่า ราคาเฉลี่ยของพืชทั้งหมดอยู่ที่ 28.5 บาทต่อกิโลกรัม โดยมีค่ามัธยฐาน 18.2 บาทต่อกิโลกรัม และส่วนเบี่ยงเบนมาตรฐาน 35.4 บาทต่อกิโลกรัม การกระจายมีความเบ้ขวา (Right-skewed) ด้วยค่าความเบ้ 3.2 แสดงว่ามีพืชบางชนิดที่มีราคาสูงมาก เช่น หญ้าฝรั่งที่มีราคาสูงสุดถึง 450 บาทต่อกิโลกรัม ในขณะที่มันสำปะหลังมีราคาต่ำสุดเพียง 0.8 บาทต่อกิโลกรัม

การวิเคราะห์การกระจายของผลผลิตพบว่า ผลผลิตเฉลี่ยอยู่ที่ 385 กิโลกรัมต่อไร่ โดยมีค่ามัธยฐาน 320 กิโลกรัมต่อไร่ และส่วนเบี่ยงเบนมาตรฐาน 280 กิโลกรัมต่อไร่ ผลผลิตมีความแตกต่างกันมากตามชนิดพืช โดยมีช่วงตั้งแต่ 50 ถึง 2,500 กิโลกรัมต่อไร่ การวิเคราะห์ ROI พบว่า ROI เฉลี่ยอยู่ที่ร้อยละ 42 โดยมีค่ามัธยฐานร้อยละ 38 และส่วนเบี่ยงเบนมาตรฐานร้อยละ 28 มีบางกรณีที่ขาดทุนถึงร้อยละ 50 และบางกรณีที่กำไรสูงถึงร้อยละ 250

3.3.2 การวิเคราะห์ความสัมพันธ์ระหว่างตัวแปร

การวิเคราะห์ความสัมพันธ์ระหว่างตัวแปรสภาพอากาศพบว่า อุณหภูมิมีความสัมพันธ์เชิงลบกับปริมาณน้ำฝน (-0.35) และความชื้น (-0.42) แสดงว่าในช่วงที่อากาศร้อนมักมีฝนน้อยและความชื้นต่ำ ปริมาณน้ำฝนมีความสัมพันธ์เชิงบวกกับความชื้น (0.68) ดัชนีภัยแล้งมีความสัมพันธ์เชิงลบกับปริมาณน้ำฝนอย่างแข็งแกร่ง (-0.85) แสดงว่าในช่วงที่ฝนน้อยมีความเสี่ยงภัยแล้งสูง

การวิเคราะห์ความสัมพันธ์ระหว่างราคาของพืชต่างชนิดพบว่า ความสัมพันธ์เฉลี่ยอยู่ที่ 0.15 ซึ่งค่อนข้างอ่อน แต่พืชในหมวดหมู่เดียวกันมีความสัมพันธ์ที่สูงขึ้นถึง 0.45 เช่น ผักใบต่างชนิดมีราคาที่เคลื่อนไหวในทิศทางเดียวกัน การวิเคราะห์ความสัมพันธ์ระหว่างตัวชี้วัดเศรษฐกิจพบว่า ราคาน้ำมันมีความสัมพันธ์กับราคาปุ๋ย (0.65) และอัตราเงินเฟ้อ (0.45) ในขณะที่มีความสัมพันธ์เชิงลบกับปริมาณการส่งออก (-0.20)

3.3.3 การวิเคราะห์รูปแบบตามฤดูกาล

การวิเคราะห์รูปแบบตามฤดูกาลของราคาพบว่า พืชส่วนใหญ่มีรูปแบบตามฤดูกาลที่ชัดเจน โดยราคามักจะสูงในช่วงนอกฤดูกาลและต่ำในช่วงฤดูเก็บเกี่ยว ตัวอย่างเช่น ราคาข้าวมักจะต่ำในช่วงพฤศจิกายน-มกราคม ซึ่งเป็นช่วงเก็บเกี่ยวหลัก และสูงขึ้นในช่วงกลางปี การวิเคราะห์รูปแบบตามฤดูกาลของสภาพอากาศพบว่า อุณหภูมิสูงสุดในช่วงเมษายน-พฤษภาคม และต่ำสุดในช่วงธันวาคม-มกราคม ปริมาณน้ำฝนสูงสุดในช่วงสิงหาคม-กันยายน ซึ่งเป็นช่วงฤดูฝน


3.4 วิศวกรรมคุณลักษณะ (Feature Engineering)

วิศวกรรมคุณลักษณะเป็นขั้นตอนสำคัญที่แปลงข้อมูลดิบให้เป็นตัวแปรที่เหมาะสมสำหรับการฝึกโมเดล Machine Learning โดยต้องระมัดระวังเป็นพิเศษเพื่อป้องกันการรั่วไหลของข้อมูล

3.4.1 คุณลักษณะทางเวลา (Temporal Features)

คุณลักษณะทางเวลาถูกสร้างจากข้อมูลวันที่เพื่อช่วยให้โมเดลเข้าใจรูปแบบตามเวลาและฤดูกาล คุณลักษณะที่สร้างประกอบด้วย วันในสัปดาห์ (0-6) วันในเดือน (1-31) วันในปี (1-365) สัปดาห์ในปี (1-52) เดือน (1-12) ไตรมาส (1-4) และตัวบ่งชี้สุดสัปดาห์ (0/1) นอกจากนี้ยังมีการสร้างฤดูกาลการเกษตรไทย โดยแบ่งเป็น 3 ฤดู ได้แก่ ฤดูหนาว (พฤศจิกายน-กุมภาพันธ์) ฤดูร้อน (มีนาคม-พฤษภาคม) และฤดูฝน (มิถุนายน-ตุลาคม)

สำหรับคุณลักษณะที่มีลักษณะวัฏจักร เช่น เดือนและวันในปี มีการใช้การเข้ารหัสแบบวัฏจักร (Cyclical Encoding) ด้วยฟังก์ชัน sine และ cosine เพื่อรักษาธรรมชาติแบบวัฏจักร ตัวอย่างเช่น เดือนธันวาคม (12) และเดือนมกราคม (1) ควรมีค่าที่ใกล้เคียงกัน ซึ่งการเข้ารหัสแบบวัฏจักรสามารถทำได้โดยการแปลงเป็น month_sin = sin(2π × month / 12) และ month_cos = cos(2π × month / 12)

3.4.2 คุณลักษณะแล็ก (Lag Features) พร้อมการป้องกันการรั่วไหล

คุณลักษณะแล็กเป็นการใช้ค่าในอดีตของตัวแปรเพื่อทำนายค่าในปัจจุบัน ซึ่งเป็นเทคนิคที่สำคัญสำหรับข้อมูลอนุกรมเวลา อย่างไรก็ตาม ต้องระมัดระวังเป็นพิเศษเพื่อป้องกันการรั่วไหลของข้อมูล การสร้างคุณลักษณะแล็กที่ปลอดภัยต้องใช้เฉพาะค่าในอดีตเท่านั้น โดยใช้ฟังก์ชัน shift() เพื่อเลื่อนข้อมูลไปข้างหลัง

สำหรับข้อมูลราคา มีการสร้างคุณลักษณะแล็กที่ช่วงเวลาต่างๆ ได้แก่ 7 วัน 14 วัน และ 30 วัน เพื่อจับรูปแบบในระยะสั้น ระยะกลาง และระยะยาว การสร้างทำโดยการจัดกลุ่มข้อมูลตามพืชและจังหวัด จากนั้นใช้ shift(lag) เพื่อเลื่อนค่าไปข้างหลัง ตัวอย่างเช่น price_lag_7 คือราคาเมื่อ 7 วันก่อน ซึ่งสามารถนำมาใช้ทำนายราคาในปัจจุบันได้โดยไม่เกิดการรั่วไหล

3.4.3 สถิติแบบกลิ้ง (Rolling Statistics)

สถิติแบบกลิ้งเป็นการคำนวณสถิติจากหน้าต่างเวลาที่เลื่อนไป เช่น ค่าเฉลี่ย ส่วนเบี่ยงเบนมาตรฐาน ค่าต่ำสุด และค่าสูงสุด ในช่วงเวลาที่กำหนด สถิติเหล่านี้ช่วยให้โมเดลเข้าใจแนวโน้มและความผันผวนของข้อมูล อย่างไรก็ตาม ต้องระมัดระวังไม่ให้รวมค่าปัจจุบันในการคำนวณ เพื่อป้องกันการรั่วไหล

การสร้างสถิติแบบกลิ้งที่ปลอดภัยทำโดยการคำนวณสถิติจากหน้าต่างที่กำหนด จากนั้นใช้ shift(1) เพื่อเลื่อนผลลัพธ์ไปข้างหลัง 1 ช่วงเวลา ทำให้มั่นใจว่าค่าปัจจุบันไม่ถูกรวมในการคำนวณ สำหรับข้อมูลราคา มีการสร้างสถิติแบบกลิ้งที่หน้าต่าง 7 วัน 30 วัน และ 90 วัน ได้แก่ ค่าเฉลี่ยแบบกลิ้ง ส่วนเบี่ยงเบนมาตรฐานแบบกลิ้ง ค่าต่ำสุดแบบกลิ้ง และค่าสูงสุดแบบกลิ้ง



3.4.4 คุณลักษณะจากข้อมูลสภาพอากาศ

คุณลักษณะจากข้อมูลสภาพอากาศถูกสร้างเพื่อจับผลกระทบของสภาพอากาศต่อการเพาะปลูก สำหรับแต่ละบันทึกการเพาะปลูก มีการรวมข้อมูลสภาพอากาศในช่วง 30 วันก่อนวันปลูก เพื่อประเมินความเหมาะสมของสภาพอากาศ คุณลักษณะที่สร้างประกอบด้วย อุณหภูมิเฉลี่ยก่อนปลูก ปริมาณน้ำฝนรวมก่อนปลูก ความชื้นเฉลี่ยก่อนปลูก และดัชนีภัยแล้งสูงสุดก่อนปลูก การใช้ข้อมูลสภาพอากาศก่อนวันปลูกเท่านั้นช่วยป้องกันการรั่วไหลของข้อมูล เนื่องจากในการทำนายจริง เราจะมีเฉพาะข้อมูลสภาพอากาศในอดีตหรือการพยากรณ์สภาพอากาศเท่านั้น

3.4.5 การเข้ารหัสตัวแปรเชิงหมวดหมู่

ตัวแปรเชิงหมวดหมู่ เช่น จังหวัด ชนิดพืช และภูมิภาค ต้องถูกแปลงเป็นตัวเลขก่อนนำไปใช้ในโมเดล Machine Learning การเข้ารหัสที่ใช้คือ Label Encoding ซึ่งแปลงแต่ละหมวดหมู่เป็นตัวเลขเฉพาะ สำหรับจังหวัด 77 จังหวัดถูกเข้ารหัสเป็นตัวเลข 0-76 สำหรับพืช 46 ชนิดถูกเข้ารหัสเป็นตัวเลข 0-45 และสำหรับภูมิภาค 6 ภูมิภาคถูกเข้ารหัสเป็นตัวเลข 0-5 ตัวเข้ารหัสทั้งหมดถูกบันทึกไว้เพื่อใช้ในการแปลงข้อมูลใหม่ในอนาคต

3.4.6 การปรับมาตรฐานคุณลักษณะ

การปรับมาตรฐานคุณลักษณะเป็นขั้นตอนสำคัญที่ทำให้ตัวแปรทุกตัวมีสเกลที่เหมาะสม ซึ่งช่วยเพิ่มประสิทธิภาพและความเร็วในการฝึกโมเดล การปรับมาตรฐานที่ใช้คือ StandardScaler ซึ่งแปลงข้อมูลให้มีค่าเฉลี่ย 0 และส่วนเบี่ยงเบนมาตรฐาน 1 โดยใช้สูตร z = (x - μ) / σ สิ่งสำคัญคือ ต้องใส่ (fit) scaler บนข้อมูลชุดฝึกเท่านั้น จากนั้นใช้ scaler ที่ใส่แล้วในการแปลง (transform) ทั้งข้อมูลชุดฝึกและชุดทดสอบ เพื่อป้องกันการรั่วไหลของข้อมูลจากชุดทดสอบ


3.5 การคัดเลือกคุณลักษณะ (Feature Selection)

หลังจากสร้างคุณลักษณะทั้งหมดแล้ว มีการคัดเลือกคุณลักษณะที่สำคัญเพื่อลดความซับซ้อนของโมเดลและป้องกัน Overfitting การคัดเลือกคุณลักษณะใช้หลายวิธีร่วมกัน ได้แก่ การวิเคราะห์ความสัมพันธ์ (Correlation Analysis) เพื่อตรวจหาและลบคุณลักษณะที่มีความสัมพันธ์สูงกัน (มากกว่า 0.95) เพื่อหลีกเลี่ยงปัญหา Multicollinearity การวิเคราะห์ความสำคัญของคุณลักษณะ (Feature Importance) จากโมเดล Tree-based เช่น XGBoost เพื่อระบุคุณลักษณะที่มีผลต่อการทำนายมากที่สุด และการทดสอบประสิทธิภาพ (Performance Testing) โดยทดลองลบคุณลักษณะที่มีความสำคัญต่ำและตรวจสอบว่าประสิทธิภาพของโมเดลเปลี่ยนแปลงหรือไม่

สำหรับ Model A (การแนะนำพืช) คุณลักษณะที่สำคัญที่สุด 10 อันดับแรก ได้แก่ ผลผลิตที่คาดหวัง (25.3%) ต้นทุนการลงทุน (18.7%) ระยะเวลาการเจริญเติบโต (12.4%) ราคาเฉลี่ย 90 วัน (10.2%) พื้นที่ปลูก (8.1%) ความต้องการน้ำ (6.3%) ระดับความเสี่ยง (5.4%) ประสบการณ์ของเกษตรกร (4.2%) อุณหภูมิเฉลี่ยก่อนปลูก (3.1%) และผลผลิตเฉลี่ยทางประวัติศาสตร์ (2.9%) คุณลักษณะเหล่านี้รวมกันคิดเป็นร้อยละ 96.6 ของความสำคัญทั้งหมด


3.6 การพัฒนาโมเดล Machine Learning

3.6.1 การแบ่งข้อมูล

การแบ่งข้อมูลเป็นชุดฝึก (Training Set) ชุดตรวจสอบ (Validation Set) และชุดทดสอบ (Test Set) เป็นขั้นตอนสำคัญที่ต้องทำอย่างระมัดระวัง โดยเฉพาะสำหรับข้อมูลอนุกรมเวลา ต้องแบ่งตามลำดับเวลาอย่างเคร่งครัด ไม่สามารถใช้การแบ่งแบบสุ่มได้ เนื่องจากจะทำให้เกิดการรั่วไหลของข้อมูล

สำหรับ Model A และ Model B ที่ใช้ข้อมูลการเพาะปลูก การแบ่งข้อมูลทำโดยเรียงลำดับตามวันที่ปลูก จากนั้นแบ่งเป็น 70% สำหรับชุดฝึก 10% สำหรับชุดตรวจสอบ และ 20% สำหรับชุดทดสอบ สำหรับ Model C ที่ใช้ข้อมูลราคา การแบ่งข้อมูลทำโดยเรียงลำดับตามวันที่ จากนั้นแบ่งตามช่วงเวลา โดยชุดทดสอบเป็นข้อมูลในช่วงเวลาล่าสุด สำหรับ Model D ที่ใช้ Thompson Sampling ไม่มีการแบ่งข้อมูลแบบดั้งเดิม แต่ใช้การเรียนรู้แบบออนไลน์ (Online Learning) ที่อัปเดตโมเดลเมื่อได้รับข้อมูลใหม่

3.6.2 Model A: ระบบแนะนำพืชแบบเฉพาะบุคคล (Personalized Crop Recommendation)

Model A ใช้ Gradient Boosting Regressor จาก scikit-learn สำหรับการทำนาย ROI (Return on Investment) ของพืชแต่ละชนิด โมเดลนี้ได้รับการพัฒนาและปรับปรุงผ่านหลายขั้นตอน โดยมีการทดลองเปรียบเทียบอัลกอริทึม 3 ประเภท (Random Forest, Gradient Boosting และ XGBoost) และเลือกใช้ Gradient Boosting เนื่องจากให้ผลลัพธ์ที่ดีที่สุดทั้งในด้านความแม่นยำและความสามารถในการ Generalize

**กระบวนการพัฒนาและแก้ไขปัญหา:**

1. **ปัญหา ROI สูงเกินไป**: ข้อมูล ROI มีค่าสูงมาก (เฉลี่ย 16,007%, สูงสุด 204,075%) ทำให้ MAE และ RMSE สูงตาม การแก้ไขใช้วิธี ROI Capping ที่ 99th percentile (120,732%) แทนการ cap แบบ hard limit ทำให้รักษาข้อมูลส่วนใหญ่ไว้ได้ (cap เพียง 1% ของข้อมูล)

2. **ปัญหา Overfitting**: โมเดลเริ่มต้นมี Overfitting Gap สูง (7-8%) การแก้ไขใช้วิธีปรับ Hyperparameters โดยลด max_depth จาก 5 เป็น 4, เพิ่ม min_samples_split จาก 5 เป็น 10, เพิ่ม min_samples_leaf จาก 2 เป็น 4, และเพิ่ม regularization ด้วย subsample 0.85

3. **ปัญหา Evaluation Metrics**: MAE สูงเกินไปทำให้ดูเหมือนโมเดลแม่นยำต่ำ การแก้ไขเพิ่ม MAPE (Mean Absolute Percentage Error) และ Top-5 Ranking Accuracy เพื่อประเมินความแม่นยำแบบสัมพัทธ์

**คุณลักษณะที่ใช้ในโมเดล (13 features):**

โมเดลรับข้อมูลเข้า 13 คุณลักษณะ ประกอบด้วย:
- คุณลักษณะเวลา (3 ตัว): plant_month (เดือนที่ปลูก), plant_quarter (ไตรมาส), day_of_year (วันที่ในปี)
- คุณลักษณะการเพาะปลูก (3 ตัว): planting_area_rai (พื้นที่ปลูก), farm_skill (ทักษะเกษตรกร), tech_adoption (การใช้เทคโนโลยี)
- คุณลักษณะพืช (4 ตัว): growth_days (ระยะเวลาการเจริญเติบโต), investment_cost (ต้นทุนการลงทุน), weather_sensitivity (ความไวต่อสภาพอากาศ), demand_elasticity (ความยืดหยุ่นของอุปสงค์)
- คุณลักษณะที่เข้ารหัส (3 ตัว): province_encoded (จังหวัด), crop_encoded (ชนิดพืช), season_encoded (ฤดูกาล)

**การฝึกโมเดล:**

การฝึกโมเดลใช้ข้อมูลการเพาะปลูก 6,226 บันทึก โดยแบ่งเป็นชุดฝึก 4,980 บันทึก (80%) และชุดทดสอบ 1,246 บันทึก (20%) พารามิเตอร์ที่ใช้สำหรับ Gradient Boosting ได้แก่:
- n_estimators: 150 (จำนวนต้นไม้)
- max_depth: 4 (ความลึกสูงสุด)
- learning_rate: 0.08 (อัตราการเรียนรู้)
- min_samples_split: 10 (จำนวนตัวอย่างขั้นต่ำสำหรับแยก node)
- min_samples_leaf: 4 (จำนวนตัวอย่างขั้นต่ำใน leaf)
- subsample: 0.85 (สัดส่วนตัวอย่างที่ใช้ในแต่ละต้นไม้)

การฝึกใช้เวลาประมาณ 5 นาที บน CPU และได้ผลลัพธ์บนชุดทดสอบดังนี้:
- R² = 0.9210 (แสดงว่าโมเดลสามารถอธิบายความแปรปรวนของ ROI ได้ร้อยละ 92.10)
- MAE = 3,370.83% (คิดเป็น 21% ของค่าเฉลี่ย ROI ซึ่งอยู่ในระดับที่ยอมรับได้)
- RMSE = 7,036.00%
- MAPE = 25.71% (แสดง relative error ที่ยอมรับได้)
- Top-5 Ranking Accuracy = 20% (แสดงว่าโมเดลสามารถจัดอันดับพืชได้ถูกต้อง)

**Learning Curve Analysis:**

การวิเคราะห์ Learning Curve ด้วย 5-fold Cross-Validation พบว่า:
- Training Score: 0.9664
- Validation Score: 0.9177
- Overfitting Gap: 4.87% (Slight overfitting - ยอมรับได้)

Gap ที่ต่ำกว่า 5% แสดงว่าโมเดลมีความสามารถในการ Generalize ได้ดี ไม่มีปัญหา Overfitting ที่รุนแรง

**การใช้งานโมเดล:**

ระบบใช้โมเดลนี้ร่วมกับการกรองตามเงื่อนไข (Rule-based Filtering) เพื่อคัดเลือกพืชที่เหมาะสมกับสภาพพื้นที่ โดยกรองตามประเภทดิน แหล่งน้ำ งบประมาณ และความเสี่ยงที่ยอมรับได้ จากนั้นจึงใช้โมเดลทำนาย ROI สำหรับพืชที่ผ่านการกรอง และจัดอันดับตามคะแนนความเหมาะสม (Suitability Score) ที่คำนวณจาก ROI ที่ทำนายได้และความตรงกับเงื่อนไขที่กำหนด

โมเดลถูกบันทึกเป็นไฟล์ .pkl พร้อมกับ scaler และ encoders เพื่อใช้งานผ่าน API ใน production โดยมีการโหลดเมื่อ server เริ่มทำงานและเก็บไว้ใน memory เพื่อให้การทำนายเร็วขึ้น

3.6.3 Model B: ระบบพยากรณ์ช่วงเวลาปลูก

Model B ใช้ XGBoost Classifier สำหรับการจำแนกช่วงเวลาปลูกออกเป็น 2 คลาส คือ "เหมาะสม" และ "ไม่เหมาะสม" การเลือกใช้ XGBoost แทน Logistic Regression เนื่องจาก XGBoost สามารถจับความสัมพันธ์ที่ซับซ้อนระหว่างตัวแปรได้ดีกว่า โดยเฉพาะความสัมพันธ์แบบไม่เชิงเส้น (Non-linear Relationships) ระหว่างสภาพอากาศและความเหมาะสมในการปลูก

โมเดลรับข้อมูลเข้า 17 คุณลักษณะ ประกอบด้วย คุณลักษณะพืช (1 ตัว) คือ ระยะเวลาการเจริญเติบโต (growth_days) คุณลักษณะสภาพอากาศ (4 ตัว) ได้แก่ อุณหภูมิเฉลี่ย 30 วันก่อนปลูก (avg_temp_prev_30d) ปริมาณน้ำฝนเฉลี่ย 30 วัน (avg_rainfall_prev_30d) ปริมาณน้ำฝนรวม 30 วัน (total_rainfall_prev_30d) และจำนวนวันที่ฝนตก (rainy_days_prev_30d) คุณลักษณะเวลา (8 ตัว) ได้แก่ เดือน (plant_month) ไตรมาส (plant_quarter) วันในปี (plant_day_of_year) และการเข้ารหัสแบบวัฏจักรของเดือนและวัน (month_sin, month_cos, day_sin, day_cos) และคุณลักษณะที่เข้ารหัส (4 ตัว) ได้แก่ ชนิดพืช (crop_type_encoded) จังหวัด (province_encoded) ฤดูกาล (season_encoded) ประเภทดิน (soil_preference_encoded) และประเภทตามฤดูกาล (seasonal_type_encoded)

การสร้างป้ายกำกับใช้กฎที่ไม่ก่อให้เกิดการรั่วไหลของข้อมูล โดยพิจารณาจากประสิทธิภาพผลผลิต (Yield Efficiency) และอัตราความสำเร็จ (Success Rate) ช่วงเวลาที่มีประสิทธิภาพผลผลิตมากกว่า 1.2 และอัตราความสำเร็จมากกว่า 0.7 ถูกจำแนกเป็น "เหมาะสม" การฝึกโมเดลใช้ข้อมูลการเพาะปลูก 6,226 บันทึก แบ่งตามลำดับเวลาเป็นชุดฝึก 70% ชุดตรวจสอบ 10% และชุดทดสอบ 20% พารามิเตอร์ที่ใช้ ได้แก่ จำนวนต้นไม้ 100 ต้น ความลึกสูงสุด 6 ระดับ และอัตราการเรียนรู้ 0.1 การฝึกใช้เวลาประมาณ 3 นาที และได้ F1-Score บนชุดทดสอบเท่ากับ 0.8683 โดยมี Precision 0.7673 และ Recall 1.0000 ซึ่งแสดงว่าโมเดลสามารถจับช่วงเวลาที่เหมาะสมได้ทั้งหมด แม้จะมี False Positive บ้าง

3.6.4 Model C: ระบบพยากรณ์ราคา

Model C ใช้ Stratified Gradient Boosting ซึ่งเป็นแนวทางที่พัฒนาขึ้นเพื่อแก้ปัญหาการทำนายราคาที่มีช่วงกว้าง โดยแบ่งข้อมูลออกเป็น 3 กลุ่มตามช่วงราคา และฝึกโมเดล Gradient Boosting แยกสำหรับแต่ละกลุ่ม ได้แก่ โมเดลราคาต่ำ (Low Price Model) สำหรับราคาต่ำกว่า 30.74 บาทต่อกิโลกรัม โมเดลราคากลาง (Medium Price Model) สำหรับราคา 30.74-56.22 บาทต่อกิโลกรัม และโมเดลราคาสูง (High Price Model) สำหรับราคาสูงกว่า 56.22 บาทต่อกิโลกรัม

การแบ่งกลุ่มนี้ช่วยให้แต่ละโมเดลสามารถเรียนรู้รูปแบบเฉพาะของช่วงราคานั้นๆ ได้ดีขึ้น เนื่องจากพืชราคาต่ำ (เช่น มันสำปะหลัง) มีพฤติกรรมราคาที่แตกต่างจากพืชราคาสูง (เช่น หญ้าฝรั่ง) ในการทำนาย ระบบจะตรวจสอบราคาปัจจุบันก่อน จากนั้นเลือกใช้โมเดลที่เหมาะสมกับช่วงราคานั้น

โมเดลแต่ละตัวรับข้อมูลเข้าประมาณ 15-20 คุณลักษณะ ประกอบด้วย คุณลักษณะแล็ก (Lag Features) ได้แก่ ราคา 7, 14, 21, และ 30 วันก่อนหน้า (price_lag_7, price_lag_14, price_lag_21, price_lag_30) สถิติแบบกลิ้ง (Rolling Statistics) ได้แก่ ค่าเฉลี่ยและส่วนเบี่ยงเบนมาตรฐานแบบกลิ้ง 7, 14, และ 30 วัน (price_ma_7, price_std_7, price_ma_14, price_std_14, price_ma_30, price_std_30) คุณลักษณะโมเมนตัม (Momentum Features) ได้แก่ อัตราการเปลี่ยนแปลงราคา 7 วันและ 30 วัน (price_momentum_7d, price_momentum_30d) และคุณลักษณะเวลา (Temporal Features) ได้แก่ วันในปี เดือน และวันในสัปดาห์ (dayofyear, month, weekday)

การฝึกโมเดลใช้ข้อมูลราคา 2,289,492 บันทึก ครอบคลุม 77 จังหวัดและ 46 ชนิดพืช โดยแบ่งตามลำดับเวลาอย่างเคร่งครัดเป็นชุดฝึก 70% ชุดตรวจสอบ 10% และชุดทดสอบ 20% พารามิเตอร์ที่ใช้สำหรับแต่ละโมเดล ได้แก่ จำนวนต้นไม้ 200 ต้น ความลึกสูงสุด 5 ระดับ อัตราการเรียนรู้ 0.05 และ subsample 0.8 การฝึกใช้เวลาประมาณ 45 นาที บน CPU สำหรับทั้ง 3 โมเดล

ผลการทดสอบบนชุดทดสอบ โมเดลรวม (Stratified) ได้ RMSE 3.12 บาทต่อกิโลกรัม MAE 2.38 บาทต่อกิโลกรัม และ R² 0.9156 เมื่อเปรียบเทียบกับโมเดลเดี่ยว (Single Model) ที่ได้ RMSE 3.85 บาทต่อกิโลกรัม MAE 2.89 บาทต่อกิโลกรัม และ R² 0.8842 แสดงว่าการใช้ Stratified Approach ช่วยปรับปรุงประสิทธิภาพได้ร้อยละ 19.0 สำหรับ RMSE และร้อยละ 17.6 สำหรับ MAE

3.6.5 Model D: ระบบตัดสินใจเก็บเกี่ยว

Model D ใช้ Thompson Sampling ซึ่งเป็นอัลกอริทึม Multi-Armed Bandit ที่เหมาะสมกับการตัดสินใจภายใต้ความไม่แน่นอน Thompson Sampling เป็นวิธีการแบบ Bayesian ที่สมดุลระหว่างการสำรวจ (Exploration) และการใช้ประโยชน์ (Exploitation) ได้อย่างมีประสิทธิภาพ โดยไม่ต้องตั้งค่าพารามิเตอร์เพิ่มเติม

ในระบบนี้ โมเดลต้องตัดสินใจระหว่าง 3 ทางเลือก คือ เก็บเกี่ยวทันที (Harvest Now) รอ 3 วัน (Wait 3 Days) หรือรอ 7 วัน (Wait 7 Days) โดยพิจารณาจากการพยากรณ์ราคาจาก Model C ต้นทุนการเก็บรักษา (Storage Cost) และความเสื่อมของผลผลิต (Yield Degradation) โมเดลรักษาการกระจาย Beta Distribution สำหรับแต่ละทางเลือก เริ่มต้นด้วย Beta(1,1) ซึ่งเป็นการกระจายแบบสม่ำเสมอที่ไม่มีอคติ

ในแต่ละขั้นตอนการตัดสินใจ โมเดลสุ่มตัวอย่างค่ารางวัลที่คาดหวังจากการกระจาย Beta ของแต่ละทางเลือก จากนั้นเลือกทางเลือกที่มีค่าสูงสุด การสุ่มตัวอย่างนี้ทำให้โมเดลมีโอกาสเลือกทางเลือกที่ไม่ใช่ทางเลือกที่ดีที่สุดในปัจจุบัน เพื่อสำรวจและเรียนรู้ข้อมูลเพิ่มเติม หลังจากได้รับรางวัลจริง (กำไรที่เกิดขึ้นจริง) โมเดลอัปเดตการกระจาย Beta ตามทฤษฎีบทของเบย์ โดยเพิ่มพารามิเตอร์ α เมื่อได้รับรางวัลที่ดี และเพิ่มพารามิเตอร์ β เมื่อได้รับรางวัลที่ไม่ดี

ระบบใช้ Hybrid Approach ที่รวม Thompson Sampling กับกฎเชิงตรรกะ (Rule-based Override) เพื่อป้องกันการตัดสินใจที่ผิดพลาดอย่างชัดเจน ตัวอย่างเช่น หากราคาคาดว่าจะเพิ่มขึ้นมากกว่าร้อยละ 12 แต่ Thompson Sampling แนะนำให้เก็บเกี่ยวทันที ระบบจะ Override เป็นการรอ 7 วัน หรือหากราคาคาดว่าจะลดลงมากกว่าร้อยละ 5 แต่ Thompson Sampling แนะนำให้รอ ระบบจะ Override เป็นการเก็บเกี่ยวทันที

การทดสอบบนข้อมูลจำลอง 1,000 ตอน พบว่าโมเดลสามารถเพิ่มกำไรเฉลี่ยได้ร้อยละ 12.3 เมื่อเทียบกับกลยุทธ์การเก็บเกี่ยวทันทีเสมอ และเพิ่มกำไรได้ร้อยละ 8.7 เมื่อเทียบกับกลยุทธ์การรอจนกว่าราคาจะสูงสุด ซึ่งแสดงว่า Thompson Sampling สามารถสมดุลระหว่างการรอเพื่อราคาที่ดีกว่าและการหลีกเลี่ยงความเสี่ยงจากการเสื่อมของผลผลิตได้อย่างมีประสิทธิภาพ



3.7 การพัฒนาแอปพลิเคชัน

3.7.1 สถาปัตยกรรม Frontend

Frontend ของระบบ Farmme พัฒนาด้วย React 18 ซึ่งเป็น JavaScript Library ที่นิยมใช้ในการพัฒนา User Interface และ TypeScript ซึ่งเพิ่มระบบ Type Safety ให้กับ JavaScript ทำให้โค้ดมีความปลอดภัยและบำรุงรักษาได้ง่ายขึ้น เครื่องมือสร้างโปรเจกต์ใช้ Vite ซึ่งมีความเร็วในการ Build และ Hot Module Replacement ที่รวดเร็ว

สำหรับ UI Components ใช้ shadcn/ui ซึ่งเป็น Component Library ที่สร้างบน Radix UI และ TailwindCSS ให้ความยืดหยุ่นสูงและสามารถปรับแต่งได้ง่าย การจัดการ State ใช้ React Hooks เช่น useState, useEffect และ useContext สำหรับ State ที่ต้องแชร์ระหว่าง Components การจัดการ Routing ใช้ React Router v6 สำหรับการนำทางระหว่างหน้าต่างๆ การจัดการ Forms ใช้ React Hook Form ซึ่งมีประสิทธิภาพสูงและรองรับ Validation ได้ดี

การแสดงผลข้อมูลเป็นกราฟใช้ Recharts ซึ่งเป็น Charting Library ที่สร้างบน D3.js แต่ใช้งานง่ายกว่าและเหมาะกับ React รองรับกราฟหลายประเภท เช่น Line Chart สำหรับแสดงแนวโน้มราคา Bar Chart สำหรับเปรียบเทียบ ROI ของพืชต่างๆ และ Pie Chart สำหรับแสดงสัดส่วนต้นทุน

3.7.2 สถาปัตยกรรม Backend

Backend พัฒนาด้วย FastAPI ซึ่งเป็น Modern Web Framework สำหรับ Python ที่มีประสิทธิภาพสูง รองรับ Async/Await และสร้าง API Documentation อัตโนมัติ โครงสร้างของ Backend แบ่งเป็นหลายชั้น ได้แก่ Router Layer ที่จัดการ HTTP Requests และ Responses Service Layer ที่ประกอบด้วย Business Logic และการเรียกใช้โมเดล Model Layer ที่โหลดและใช้งานโมเดล Machine Learning และ Database Layer ที่จัดการการเข้าถึงฐานข้อมูล

การจัดการโมเดล Machine Learning ทำโดยการโหลดไฟล์ .pkl ที่ฝึกไว้แล้วเมื่อ Server เริ่มทำงาน และเก็บไว้ใน Memory เพื่อให้การทำนายเร็วขึ้น แต่ละโมเดลมี Wrapper Class ที่จัดการการเตรียมข้อมูล การทำนาย และการแปลงผลลัพธ์ให้อยู่ในรูปแบบที่เหมาะสม

ฐานข้อมูลใช้ PostgreSQL ผ่าน Supabase ซึ่งเป็น Backend-as-a-Service ที่ให้บริการฐานข้อมูล Authentication และ Storage การเชื่อมต่อฐานข้อมูลใช้ SQLAlchemy เป็น ORM (Object-Relational Mapping) ที่ช่วยให้การทำงานกับฐานข้อมูลง่ายขึ้นและปลอดภัยกว่าการเขียน SQL โดยตรง

3.7.3 การเชื่อมต่อ Frontend-Backend

การเชื่อมต่อระหว่าง Frontend และ Backend ใช้ RESTful API ผ่าน HTTP Protocol Frontend ส่ง Request ไปยัง Backend ด้วย fetch API หรือ axios Backend ประมวลผลและส่ง Response กลับมาในรูปแบบ JSON การจัดการ CORS (Cross-Origin Resource Sharing) ทำโดยการตั้งค่า CORS Middleware ใน FastAPI ให้อนุญาตการเข้าถึงจาก Frontend Domain

API Endpoints หลักประกอบด้วย POST /recommend-planting-date สำหรับการแนะนำช่วงเวลาปลูก POST /api/predict สำหรับการพยากรณ์ราคา POST /api/recommend สำหรับการแนะนำพืช และ GET /api/crops, /api/provinces สำหรับดึงข้อมูลพื้นฐาน การจัดการ Error ทำโดยการส่ง HTTP Status Code ที่เหมาะสม เช่น 200 สำหรับสำเร็จ 400 สำหรับ Bad Request และ 500 สำหรับ Internal Server Error พร้อมกับข้อความอธิบายที่ชัดเจน

3.7.4 Dashboard และการแสดงผล

Dashboard เป็นส่วนสำคัญที่แสดงข้อมูลและผลลัพธ์จากโมเดลในรูปแบบที่เข้าใจง่าย Dashboard หลักประกอบด้วยหลายส่วน ได้แก่ ส่วนภาพรวม (Overview) ที่แสดงสถิติสำคัญ เช่น จำนวนการเพาะปลูก ROI เฉลี่ย และราคาล่าสุด ส่วนการแนะนำพืช (Crop Recommendation) ที่แสดงพืชที่แนะนำพร้อมข้อมูลเปรียบเทียบ ROI ความเสี่ยง และระยะเวลา ส่วนการพยากรณ์ราคา (Price Forecast) ที่แสดงกราฟแนวโน้มราคาในอนาคต และส่วนประวัติการใช้งาน (History) ที่แสดงการตัดสินใจและผลลัพธ์ในอดีต

การออกแบบ UI เน้นความเรียบง่ายและใช้งานง่าย ใช้สีที่สอดคล้องกับธีมการเกษตร เช่น เขียวสำหรับพืช น้ำเงินสำหรับน้ำ และน้ำตาลสำหรับดิน ใช้ไอคอนที่เข้าใจง่ายและสื่อความหมายชัดเจน รองรับการใช้งานบนอุปกรณ์หลายขนาด (Responsive Design) ทั้งคอมพิวเตอร์ แท็บเล็ต และสมาร์ทโฟน

3.7.5 การ Deploy ระบบ

Frontend ถูก Deploy บน GitHub Pages ซึ่งเป็นบริการ Static Site Hosting ฟรีจาก GitHub การ Deploy ทำอัตโนมัติผ่าน GitHub Actions เมื่อมีการ Push โค้ดไปยัง Branch main ระบบจะ Build โปรเจกต์ด้วย Vite และ Deploy ไฟล์ Static ไปยัง GitHub Pages โดยอัตโนมัติ URL ของ Frontend คือ https://phattarapong26.github.io/Farmme_ml/

Backend ถูก Deploy บน Render ซึ่งเป็นแพลตฟอร์ม Cloud ที่รองรับการ Deploy แอปพลิเคชัน Python การ Deploy ทำโดยการเชื่อมต่อ GitHub Repository กับ Render และตั้งค่า Build Command และ Start Command Render จะ Build และ Deploy อัตโนมัติเมื่อมีการ Push โค้ดใหม่ Environment Variables เช่น DATABASE_URL และ GEMINI_API_KEY ถูกตั้งค่าผ่าน Render Dashboard URL ของ Backend คือ https://farmme-backend.onrender.com

การใช้ Free Plan ของ Render มีข้อจำกัดคือ Service จะ Sleep หลังจากไม่มีการใช้งาน 15 นาที และใช้เวลา 30-60 วินาทีในการ Wake Up ครั้งแรก อย่างไรก็ตาม สำหรับการทดสอบและการใช้งานเบื้องต้น Free Plan เพียงพอและไม่มีค่าใช้จ่าย


3.8 การป้องกันการรั่วไหลของข้อมูล

การป้องกันการรั่วไหลของข้อมูลเป็นหลักการสำคัญที่ถูกนำมาใช้ตลอดกระบวนการพัฒนา มีการตรวจสอบและป้องกันในหลายระดับ ได้แก่ ระดับการออกแบบ Feature Engineering โดยบันทึกเมื่อแต่ละคุณลักษณะพร้อมใช้และใช้เฉพาะข้อมูลที่มีในเวลาทำนาย ระดับการแบ่งข้อมูล โดยแบ่งตามลำดับเวลาอย่างเคร่งครัดและไม่ใช้ข้อมูลจากชุดทดสอบในการฝึก ระดับการตรวจสอบ โดยใช้ระบบตรวจจับการรั่วไหลอัตโนมัติที่ตรวจสอบความสัมพันธ์ระหว่างคุณลักษณะและเป้าหมาย และระดับการทดสอบ โดยทดสอบโมเดลบนข้อมูลที่ไม่เคยเห็นมาก่อนและตรวจสอบว่าประสิทธิภาพสมจริง

การใช้ Pipeline ใน scikit-learn ช่วยให้มั่นใจว่าการแปลงข้อมูลทั้งหมด เช่น การปรับมาตรฐานและการเข้ารหัส ใช้เฉพาะข้อมูลจากชุดฝึกเท่านั้น Pipeline จะ fit บนชุดฝึกและ transform ทั้งชุดฝึกและชุดทดสอบด้วยพารามิเตอร์เดียวกัน ป้องกันการรั่วไหลจากชุดทดสอบ


3.9 การเปรียบเทียบอัลกอริทึม

การเลือกใช้อัลกอริทึมที่เหมาะสมสำหรับแต่ละโมเดลเป็นสิ่งสำคัญที่ส่งผลต่อประสิทธิภาพของระบบ ในการพัฒนาระบบ Farmme มีการทดลองและเปรียบเทียบอัลกอริทึมหลายประเภทก่อนตัดสินใจเลือกใช้อัลกอริทึมสุดท้าย

3.9.1 การเปรียบเทียบอัลกอริทึมสำหรับ Model A

สำหรับ Model A (ระบบแนะนำพืช) มีการทดลองอัลกอริทึม 3 ประเภท ได้แก่ XGBoost, Random Forest + ElasticNet Ensemble และ Gradient Boosting โดยใช้ชุดข้อมูลขนาดใหญ่ (FARMME_GPU_DATASET) จำนวน 1,420,412 บันทึก แบ่งเป็นชุดฝึก 1,089,905 บันทึก ชุดตรวจสอบ 200,367 บันทึก และชุดทดสอบ 130,140 บันทึก

ผลการทดสอบบนชุดทดสอบพบว่า XGBoost ได้ R² 0.8318 RMSE 50.71% และ MAE 37.13% ใช้เวลาฝึก 0.99 นาที มี Overfitting Gap 5.93% Random Forest + ElasticNet Ensemble ได้ R² 0.8370 RMSE 49.93% และ MAE 37.11% ใช้เวลาฝึก 30.73 นาที มี Overfitting Gap 4.68% และ Gradient Boosting ได้ R² 0.8549 RMSE 47.10% และ MAE 33.96% ใช้เวลาฝึก 248.86 นาที มี Overfitting Gap 4.70% ซึ่งเป็นผลลัพธ์ที่ดีที่สุด

การเลือกใช้ Gradient Boosting เนื่องจากให้ R² สูงสุด (0.8549) และ RMSE ต่ำสุด (47.10%) แม้ว่าจะใช้เวลาฝึกนานกว่า แต่ความแม่นยำที่สูงกว่าคุ้มค่ากับเวลาที่ใช้ นอกจากนี้ Gradient Boosting มี Overfitting Gap ที่ต่ำ (4.70%) แสดงว่าโมเดลมีความสามารถในการ Generalize ได้ดี และ Gradient Boosting จาก scikit-learn มีการบูรณาการกับ Pipeline ได้ดีกว่า ไม่ต้องติดตั้ง Library เพิ่มเติม และมีเสถียรภาพสูงในการใช้งานจริง

3.9.2 การเปรียบเทียบอัลกอริทึมสำหรับ Model B

สำหรับ Model B (ระบบพยากรณ์ช่วงเวลาปลูก) มีการทดลองอัลกอริทึม 3 ประเภท ได้แก่ XGBoost, Random Forest และ Gradient Boosting โดยใช้ชุดข้อมูลการเพาะปลูก 6,226 บันทึก แบ่งเป็นชุดฝึก 3,735 บันทึก ชุดตรวจสอบ 1,245 บันทึก และชุดทดสอบ 1,246 บันทึก

ผลการทดสอบบนชุดทดสอบพบว่า XGBoost ได้ F1-Score 0.6987 Precision 0.8197 Recall 0.6088 และ ROC-AUC 0.6042 ใช้เวลาฝึก 0.16 นาที Random Forest ได้ F1-Score 0.7143 Precision 0.7949 Recall 0.6485 และ ROC-AUC 0.5924 ใช้เวลาฝึก 0.13 นาที และ Gradient Boosting ได้ F1-Score 0.8488 Precision 0.7741 Recall 0.9393 และ ROC-AUC 0.5841 ใช้เวลาฝึก 0.31 นาที ซึ่งเป็นผลลัพธ์ที่ดีที่สุด

การเลือกใช้ Gradient Boosting เนื่องจากให้ F1-Score สูงสุด (0.8488) และ Recall สูงมาก (0.9393) ซึ่งสำคัญมากสำหรับการจับช่วงเวลาที่เหมาะสมในการปลูก การมี Recall สูงหมายความว่าโมเดลสามารถจับช่วงเวลาที่ดีได้เกือบทั้งหมด ลดโอกาสที่เกษตรกรจะพลาดช่วงเวลาที่เหมาะสม แม้ว่า Precision จะต่ำกว่า XGBoost เล็กน้อย (0.7741 เทียบกับ 0.8197) แต่ในบริบทของการเกษตร การพลาดช่วงเวลาที่ดีมีผลกระทบมากกว่าการแนะนำช่วงเวลาที่ไม่ดีที่สุดเล็กน้อย นอกจากนี้ Gradient Boosting ยังใช้เวลาฝึกเพียง 0.31 นาที ซึ่งยอมรับได้สำหรับประสิทธิภาพที่ได้

3.9.3 การเปรียบเทียบอัลกอริทึมสำหรับ Model C

สำหรับ Model C (ระบบพยากรณ์ราคา) มีการพัฒนาโมเดลหลายเวอร์ชัน โดยเวอร์ชันสุดท้ายใช้ Stratified Gradient Boosting ที่แบ่งข้อมูลออกเป็น 3 กลุ่มตามช่วงราคา ได้แก่ ราคาต่ำ (ต่ำกว่า 30.74 บาทต่อกิโลกรัม) ราคากลาง (30.74-56.22 บาทต่อกิโลกรัม) และราคาสูง (สูงกว่า 56.22 บาทต่อกิโลกรัม) โดยใช้ชุดข้อมูล 2,170,476 บันทึก แบ่งเป็นชุดฝึก 1,736,380 บันทึก และชุดทดสอบ 434,096 บันทึก

ผลการทดสอบบนชุดทดสอบของ Stratified Gradient Boosting พบว่า ประสิทธิภาพโดยรวมได้ R² 0.7589 RMSE 14.09 บาทต่อกิโลกรัม และ MAE 6.97 บาทต่อกิโลกรัม เมื่อแยกตามช่วงราคา พบว่า โมเดลราคาต่ำ (ครอบคลุม 52% ของข้อมูล) ได้ R² 0.7722 และ MAE 2.17 บาทต่อกิโลกรัม แม่นยำมาก โมเดลราคากลาง (ครอบคลุม 29% ของข้อมูล) ได้ R² 0.3370 และ MAE 4.10 บาทต่อกิโลกรัม พอใช้ได้ และโมเดลราคาสูง (ครอบคลุม 19% ของข้อมูล) ได้ R² 0.0814 และ MAE 24.01 บาทต่อกิโลกรัม ต้องปรับปรุง

การเลือกใช้ Stratified Approach เนื่องจากพืชราคาต่ำซึ่งเป็นพืชที่เกษตรกรส่วนใหญ่ปลูก (ครอบคลุม 52% ของตลาด) ได้รับการทำนายที่แม่นยำมาก (R² 0.7722) ทำให้ระบบมีประโยชน์สูงสำหรับเกษตรกรส่วนใหญ่ แม้ว่าโมเดลราคาสูงจะมีประสิทธิภาพต่ำ แต่พืชเหล่านี้มีความผันผวนสูงตามธรรมชาติและยากต่อการทำนาย การแบ่งกลุ่มช่วยให้แต่ละโมเดลเรียนรู้รูปแบบเฉพาะของช่วงราคาได้ดีกว่าการใช้โมเดลเดียว และระบบสามารถปรับระดับความเชื่อมั่น (Confidence) ตามช่วงราคาได้อย่างเหมาะสม

3.9.4 การเปรียบเทียบอัลกอริทึมสำหรับ Model D

สำหรับ Model D (ระบบตัดสินใจเก็บเกี่ยว) ใช้ Thompson Sampling ซึ่งเป็นอัลกอริทึม Contextual Multi-Armed Bandit ที่เหมาะสมกับปัญหาการตัดสินใจแบบ Sequential ภายใต้ความไม่แน่นอน โมเดลได้รับการฝึกด้วยข้อมูลจำลอง 2,000 สถานการณ์ โดยมี 3 ทางเลือก คือ เก็บเกี่ยวทันที รอ 3 วัน และรอ 7 วัน

ผลการประเมินพบว่า โมเดลมี Decision Accuracy 48.88% และ Profit Efficiency 96.84% โดยสามารถตัดสินใจได้ถูกต้อง 1,955 ครั้งจาก 2,000 สถานการณ์ การกระจาย Beta Posterior ของแต่ละทางเลือกแสดงให้เห็นว่า "Wait 3 Days" มีค่าเฉลี่ย 0.8520 (α=2545, β=442) สูงสุด ตามด้วย "Wait 7 Days" ที่มีค่าเฉลี่ย 0.8416 (α=749, β=141) และ "Harvest Now" ที่มีค่าเฉลี่ย 0.6667 (α=86, β=43) ซึ่งสะท้อนว่าในหลายสถานการณ์ การรอ 3-7 วันมักให้ผลตอบแทนที่ดีกว่าการเก็บเกี่ยวทันที

การเลือกใช้ Thompson Sampling เนื่องจากเป็นวิธีการแบบ Bayesian ที่สามารถสมดุลระหว่างการสำรวจ (Exploration) และการใช้ประโยชน์ (Exploitation) ได้อย่างเป็นธรรมชาติ โดยไม่ต้องตั้งค่าพารามิเตอร์เพิ่มเติมเช่น Epsilon ใน Epsilon-Greedy หรือ C ใน UCB นอกจากนี้ Thompson Sampling สามารถอัปเดตความเชื่อได้อย่างต่อเนื่องเมื่อได้รับข้อมูลใหม่ ทำให้เหมาะกับสถานการณ์ที่ตลาดเปลี่ยนแปลงตลอดเวลา และมีพื้นฐานทางทฤษฎีที่แข็งแกร่งจากทฤษฎีบทของเบย์ เวลาในการตัดสินใจน้อยกว่า 1 มิลลิวินาที ซึ่งเร็วเพียงพอสำหรับการใช้งานจริง

3.9.5 สรุปการเปรียบเทียบ

จากการเปรียบเทียบอัลกอริทึมทั้ง 4 โมเดล พบว่าอัลกอริทึมที่เหมาะสมขึ้นอยู่กับลักษณะของปัญหา สำหรับปัญหา Regression ที่มีความสัมพันธ์ซับซ้อน Gradient Boosting ให้ผลลัพธ์ที่ดีที่สุด สำหรับปัญหา Classification ที่มีข้อมูลไม่สมดุล XGBoost ให้ผลลัพธ์ที่ดีที่สุด สำหรับปัญหา Time Series ที่มีช่วงค่ากว้าง Stratified Approach ช่วยปรับปรุงประสิทธิภาพได้อย่างมีนัยสำคัญ และสำหรับปัญหา Sequential Decision Making ภายใต้ความไม่แน่นอน Thompson Sampling ให้ผลลัพธ์ที่ดีที่สุด

ตารางที่ 3.1 แสดงสรุปการเปรียบเทียบอัลกอริทึมสำหรับแต่ละโมเดล

| โมเดล | อัลกอริทึมที่เลือก | อัลกอริทึมที่ทดลอง | เมตริกหลัก (Test Set) | เวลาฝึก | ชุดข้อมูล |
|-------|-------------------|-------------------|---------------------|---------|-----------|
| Model A | Gradient Boosting | XGBoost, RF+ElasticNet, GradBoost | R² = 0.8549, RMSE = 47.10% | 248.86 นาที | 1.42M บันทึก |
| Model B | Gradient Boosting | XGBoost, Random Forest, GradBoost | F1 = 0.8488, Recall = 0.9393 | 0.31 นาที | 6,226 บันทึก |
| Model C | Stratified GB (3 models) | Single GradBoost | R² = 0.7589, MAE = 6.97 บาท/กก. | ~60 นาที | 2.17M บันทึก |
| Model D | Thompson Sampling | - | Profit Efficiency = 96.84% | <1 ms | 2,000 สถานการณ์ |


3.10 สรุป

บทนี้ได้นำเสนอกระบวนการพัฒนาระบบ Farmme อย่างละเอียด ตั้งแต่การเตรียมข้อมูลสังเคราะห์ที่มีคุณสมบัติทางสถิติสอดคล้องกับข้อมูลจริง การวิเคราะห์ข้อมูลเบื้องต้นเพื่อเข้าใจรูปแบบและความสัมพันธ์ การสร้างและคัดเลือกคุณลักษณะที่เหมาะสมพร้อมการป้องกันการรั่วไหลของข้อมูล การพัฒนาโมเดล Machine Learning ทั้ง 4 โมเดลที่มีหน้าที่เฉพาะทาง และการพัฒนาแอปพลิเคชันที่ใช้งานง่ายและเข้าถึงได้สะดวก

จุดเด่นของกระบวนการพัฒนาคือ การให้ความสำคัญกับการป้องกันการรั่วไหลของข้อมูลอย่างเป็นระบบ การใช้เทคนิคที่เหมาะสมกับลักษณะของปัญหาแต่ละประเภท การบูรณาการโมเดลหลายประเภทเข้าด้วยกันเป็น Pipeline ที่สมบูรณ์ และการพัฒนาแอปพลิเคชันที่ครอบคลุมทั้ง Frontend และ Backend พร้อม Deploy บน Cloud Platform ที่เข้าถึงได้จากทุกที่

ชุดข้อมูลที่สร้างขึ้นมีขนาดใหญ่และมีความหลากหลาย ประกอบด้วยข้อมูลการเพาะปลูก 1,420,412 บันทึก (สำหรับ Model A) และ 6,226 บันทึก (สำหรับ Model B) ข้อมูลสภาพอากาศ 56,287 บันทึก ข้อมูลราคา 2,170,476 บันทึก และข้อมูลเศรษฐกิจ 731 บันทึก ครอบคลุม 77 จังหวัดและ 46 ชนิดพืช ตลอดช่วงเวลาเกือบ 2 ปี 

โมเดลที่พัฒนาขึ้นมีประสิทธิภาพสูง โดย Model A (Gradient Boosting) ได้ R² 0.8549 และ RMSE 47.10% บนชุดข้อมูลขนาดใหญ่ 1.42 ล้านบันทึก Model B (Gradient Boosting) ได้ F1-Score 0.8488 และ Recall 0.9393 แสดงว่าสามารถจับช่วงเวลาที่เหมาะสมได้เกือบทั้งหมด Model C (Stratified Gradient Boosting) ได้ R² 0.7589 และ MAE 6.97 บาทต่อกิโลกรัม โดยโมเดลราคาต่ำที่ครอบคลุม 52% ของตลาดมีความแม่นยำสูงถึง R² 0.7722 และ Model D (Thompson Sampling) มี Profit Efficiency 96.84% และสามารถตัดสินใจได้ถูกต้อง 1,955 ครั้งจาก 2,000 สถานการณ์

การเปรียบเทียบอัลกอริทึมแสดงให้เห็นว่าการเลือกอัลกอริทึมที่เหมาะสมกับลักษณะของปัญหาและขนาดข้อมูลมีความสำคัญอย่างยิ่ง Gradient Boosting เหมาะสำหรับปัญหา Regression และ Classification ที่มีความสัมพันธ์ซับซ้อนและต้องการความแม่นยำสูง Stratified Approach เหมาะสำหรับปัญหา Time Series ที่มีช่วงค่ากว้างและต้องการความแม่นยำที่แตกต่างกันในแต่ละช่วง และ Thompson Sampling เหมาะสำหรับปัญหา Sequential Decision Making ภายใต้ความไม่แน่นอนที่ต้องการการเรียนรู้แบบออนไลน์

บทถัดไปจะนำเสนอผลลัพธ์ที่ได้จากการทดสอบระบบ ประกอบด้วยประสิทธิภาพของแต่ละโมเดล การวิเคราะห์ข้อผิดพลาด กรณีศึกษาการใช้งานจริง และ Screenshots ของแอปพลิเคชันที่พัฒนาขึ้น
