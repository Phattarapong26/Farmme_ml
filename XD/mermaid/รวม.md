---
config:
  theme: forest
---
flowchart TB
    Start(["เริ่มต้น"]) --> DataGen["Data Generation<br>GPU-Accelerated<br>2.3M+ records"]
    DataGen --> EDA["Exploratory Data Analysis<br>Statistical &amp; Correlation Analysis"]
    EDA --> FE["Feature Engineering<br>One-hot, Temporal, Cyclical"]
    FE --> FS["Feature Selection<br>Importance &amp; Leakage Prevention"]
    FS --> Split["Train/Test Split<br>Temporal Split 75/25"]
    Split --> ModelA["Model A: Crop Recommendation<br>NSGA-II + XGBoost"] & ModelB["Model B: Planting Window<br>Logistic Regression"] & ModelC["Model C: Price Forecasting<br>XGBoost + External Features"] & ModelD["Model D: Harvest Timing<br>Thompson Sampling"]
    ModelA --> EvalA["Evaluate: R² = 0.9944"]
    ModelB --> EvalB["Evaluate: F1 = 0.72"]
    ModelC --> EvalC["Evaluate: MAE = 13.31"]
    ModelD --> EvalD["Evaluate: Accuracy = 68%"]
    EvalA --> ErrorAnalysis["Error Analysis<br>Temporal Bias &amp; Leakage Detection"]
    EvalB --> ErrorAnalysis
    EvalC --> ErrorAnalysis
    EvalD --> ErrorAnalysis
    ErrorAnalysis --> App["Application Development<br>FastAPI + React"]
    App --> End(["เสร็จสิ้น"])
    style ModelA fill:#e1f5ff
    style ModelB fill:#e1f5ff
    style ModelC fill:#e1f5ff
    style ModelD fill:#e1f5ff
    style EvalA fill:#c8e6c9
    style EvalB fill:#c8e6c9
    style EvalC fill:#c8e6c9
    style EvalD fill:#c8e6c9



flowchart LR
    Farmer([เกษตรกร]) --> Input[ข้อมูลเริ่มต้น<br/>จังหวัด พื้นที่<br/>งบประมาณ ความเสี่ยง]
    
    Input --> ModelA[Model A<br/>Crop Recommendation<br/>NSGA-II + XGBoost]
    ModelA --> OutputA[แนะนำพืช 3 อันดับ<br/>Pareto Front<br/>Trade-offs]
    
    OutputA --> Decision1{เลือกพืช}
    Decision1 --> ModelB[Model B<br/>Planting Window<br/>Logistic Regression]
    ModelB --> OutputB[ช่วงเวลาปลูก<br/>Probability 92%]
    
    OutputB --> Decision2{ปลูกแล้ว}
    Decision2 --> ModelC[Model C<br/>Price Forecasting<br/>XGBoost]
    ModelC --> OutputC[พยากรณ์ราคา<br/>MAE 13.31 บาท]
    
    OutputC --> Decision3{ใกล้เก็บเกี่ยว}
    Decision3 --> ModelD[Model D<br/>Harvest Timing<br/>Thompson Sampling]
    ModelD --> OutputD[เวลาเก็บเกี่ยว<br/>Accuracy 68%]
    
    OutputD --> Result[ผลลัพธ์<br/>ROI กำไร ความเสี่ยง]
    Result --> Farmer
    
    style ModelA fill:#4CAF50
    style ModelB fill:#2196F3
    style ModelC fill:#FF9800
    style ModelD fill:#9C27B0
    style OutputA fill:#C8E6C9
    style OutputB fill:#BBDEFB
    style OutputC fill:#FFE0B2
    style OutputD fill:#E1BEE7






flowchart TB
    subgraph "Client Layer"
        Web[Web Browser]
        Mobile[Mobile App]
    end
    
    subgraph "API Layer"
        API[FastAPI Server<br/>REST API]
        Auth[Authentication<br/>JWT]
    end
    
    subgraph "Service Layer"
        S1[Crop Recommendation<br/>Service]
        S2[Planting Window<br/>Service]
        S3[Price Forecast<br/>Service]
        S4[Harvest Timing<br/>Service]
    end
    
    subgraph "Model Layer"
        M1[NSGA-II + XGBoost]
        M2[Logistic Regression]
        M3[XGBoost + Features]
        M4[Thompson Sampling]
    end
    
    subgraph "Data Layer"
        DB[(PostgreSQL<br/>Database)]
        Cache[(Redis<br/>Cache)]
    end
    
    Web --> API
    Mobile --> API
    API --> Auth
    Auth --> S1
    Auth --> S2
    Auth --> S3
    Auth --> S4
    
    S1 --> M1
    S2 --> M2
    S3 --> M3
    S4 --> M4
    
    S1 --> DB
    S2 --> DB
    S3 --> DB
    S4 --> DB
    
    S3 --> Cache
    
    style API fill:#2196F3
    style M1 fill:#4CAF50
    style M2 fill:#4CAF50
    style M3 fill:#4CAF50
    style M4 fill:#4CAF50
    style DB fill:#FF9800
    style Cache fill:#FF9800



%%{init: {'theme':'base'}}%%
graph LR
    subgraph "Baseline Model"
        B1[Temporal Bias<br/>96.79%]
        B2[MAE<br/>18.45 บาท]
    end
    
    subgraph "Improved Model"
        I1[Temporal Bias<br/>68.09%]
        I2[MAE<br/>13.31 บาท]
    end
    
    B1 -->|ลดลง 28.7%| I1
    B2 -->|ลดลง 27.9%| I2
    
    style B1 fill:#FF5722
    style B2 fill:#FF5722
    style I1 fill:#4CAF50
    style I2 fill:#4CAF50
